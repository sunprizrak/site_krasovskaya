{% extends 'main/layout.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block header %}
<header id="news-header">
    {% include 'main/navbar.html' %}
</header>
{% endblock %}

{% block main %}
<main id="news-main">
    <div class="container" id="news-container">
        <div class="row-1" id="news-top">
            <div class="col pt-4 d-flex justify-content-center">
                <h2>Новости</h2>
            </div>
            <div class="col pb-2 d-flex justify-content-center">
                <p>
                    Я веду блоги в инстаграм и телеграм, размешаю там посты о психологии и еще <br>
                    что-нибудь тут написать о новостях и переходите на мой инстаграм и вообще
                </p>
            </div>
        </div>
        <div class="row-1" id="news-middle">
            <div class="col full-width-hr"></div>
            <div class="col d-flex flex-column flex-fill news-wrap">
                {% for news_item in news %}
                    <div class="row pb-5 news">
                        <div class="col d-flex justify-content-center">
                            <strong>{{ news_item.title }}</strong>
                        </div>
                        <div class="col mt-3">
                            <img src="{{ news_item.image.url }}" alt="news-image">
                            <div class="news-text">
                                {{ news_item.text|safe }}
                            </div>
                        </div>
                        <div class="col heart-wrap">
                            <div class="heart" data-news-id="{{ news_item.id }}">
                                <span>{{ news_item.likes }}</span>
                                <i class="bi bi-heart-fill"></i>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <div class="col full-width-hr"></div>
        </div>
        <div class="row" id="news-bottom">
            <div class="col d-flex align-items-center">
                <button type="button" data-bs-toggle="modal" data-bs-target="#feedback_subscribe">ПОДПИСАТЬСЯ НА РАССЫЛКУ</button>
            </div>
            <div class="col d-flex justify-content-end align-items-center">
                <button type="button" data-bs-toggle="modal" data-bs-target="#feedback_modal">ЗАДАТЬ ВОПРОС</button>
            </div>
        </div>
    </div>
</main>
{% endblock %}

{% block modal %}
    {% include 'main/feedback_modal.html' %}
    <div class="modal fade" id="feedback_subscribe" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <form method="post">
                {% csrf_token %}
                <div class="modal-content">
                    <div class="modal-header justify-content-end">
                        <div class="circle-button" data-bs-dismiss="modal" aria-label="Close"></div>
                    </div>
                    <div class="modal-body">
                        <div class="row-1 mb-3">
                            <div class="col d-flex justify-content-center">
                                <label for="scheduleInputName" class="form-label">Ваше имя</label>
                            </div>
                            <div class="col d-flex justify-content-center">
                                <input type="text" class="form-control" id="scheduleInputName">
                            </div>
                        </div>
                        <div class="row-1 mb-3">
                            <div class="col d-flex justify-content-center">
                                <label for="scheduleInputEmail" class="form-label">
                                    Адрес электронной почты
                                </label>
                            </div>
                            <div class="col d-flex justify-content-center">
                                <input type="email" class="form-control" id="scheduleInputEmail">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col d-flex justify-content-center">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="" id="data_check">
                                    <label class="form-check-label" for="data_check">
                                        Согласен/ на обработку персональных данных
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col d-flex justify-content-center">
                                <strong>
                                    Обещаем не спамить, а присылать только самые важные новости :)
                                </strong>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-center">
                        <button type="submit" class="btn" data-bs-dismiss="modal">Подписаться</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
{% endblock %}

{% block js %}
<script>
    $(document).ready(function() {
        $('.heart').click(function() {
            var newsId = $(this).data('news-id');
            var likeCount = $(this).find('span');

            $.ajax({
                url: '',
                type: 'POST',
                data: {
                    'news_id': newsId,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(data) {
                    if (data.success) {
                        likeCount.text(data.likes);
                    } else {
                        alert(data.error);
                    }
                }
            });
        });
    });
</script>
{% endblock %}